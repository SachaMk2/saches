<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sacha FX | Sovereign V12 Cloud</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020202; color: #ffffff; overflow: hidden; height: 100dvh; }
        .glass { background: rgba(15, 15, 15, 0.75); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.06); }
        .neon-blue { text-shadow: 0 0 12px rgba(59, 130, 246, 0.5); color: #3b82f6; }
        .verdict-denied { border: 1px solid #ff4d4d; color: #ff4d4d; background: rgba(255, 77, 77, 0.05); }
        .verdict-caution { border: 1px solid #ffcc00; color: #ffcc00; background: rgba(255, 204, 0, 0.05); }
        .verdict-elite { border: 1px solid #00ff88; color: #00ff88; background: rgba(0, 255, 136, 0.05); }
        .tab-content { display: none; height: calc(100dvh - 180px); overflow-y: auto; scrollbar-width: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        #side-log { position: fixed; right: -360px; top: 0; width: 360px; height: 100vh; transition: 0.4s cubic-bezier(0.16, 1, 0.3, 1); z-index: 150; }
        #side-log.open { right: 0; }
        input[type="checkbox"] { appearance: none; width: 18px; height: 18px; border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; cursor: pointer; position: relative; }
        input[type="checkbox"]:checked { background: #3b82f6; border-color: #3b82f6; box-shadow: 0 0 10px #3b82f6; }
        input[type="checkbox"]:checked::after { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; font-size: 10px; color: white; position: absolute; left: 3px; top: 1px; }
        #auth-overlay { position: fixed; inset: 0; background: #020202; z-index: 200; display: flex; align-items: center; justify-content: center; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="p-4 md:p-6 flex flex-col items-center">

    <button onclick="toggleLog()" class="fixed right-0 top-1/2 -translate-y-1/2 bg-blue-600/90 p-4 rounded-l-2xl z-[140] shadow-xl hover:pr-6 transition-all">
        <i class="fas fa-history text-white text-lg"></i>
    </button>

    <div id="side-log" class="glass border-l border-white/10 p-6 shadow-2xl">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xs font-black uppercase tracking-[0.3em] text-slate-400 italic">Discipline History</h2>
            <button onclick="toggleLog()" class="text-slate-500 hover:text-white"><i class="fas fa-times"></i></button>
        </div>
        <div id="audit-history-list" class="space-y-3 overflow-y-auto h-[75vh] pr-2"></div>
        <button onclick="clearLogs()" class="w-full mt-6 text-[9px] uppercase font-black text-red-500/40 hover:text-red-500 tracking-widest transition">Clear Memory</button>
    </div>

    <div id="auth-overlay">
        <div class="glass p-10 rounded-[2.5rem] w-full max-w-sm text-center border-white/10">
            <h2 class="text-2xl font-black uppercase tracking-tighter mb-2">Sentinel <span class="neon-blue">Sync</span></h2>
            <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-8 italic">Authenticating Sacha FX...</p>
            <input type="email" id="auth-email" placeholder="Email" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl mb-3 outline-none focus:border-blue-500 text-white transition">
            <input type="password" id="auth-pass" placeholder="Password" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl mb-6 outline-none focus:border-blue-500 text-white transition">
            <div class="grid grid-cols-2 gap-3">
                <button onclick="handleAuth('login')" class="bg-blue-600 py-4 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-blue-500 transition">Login</button>
                <button onclick="handleAuth('signup')" class="glass py-4 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-white/10 transition">Sign Up</button>
            </div>
            <p id="auth-msg" class="mt-6 text-[10px] text-red-500 uppercase font-black italic"></p>
        </div>
    </div>

    <div id="app-container" class="hidden max-w-5xl w-full flex flex-col h-full">
        <header class="flex flex-col md:flex-row justify-between items-center mb-10 gap-6">
            <div>
                <h1 class="text-2xl md:text-3xl font-black tracking-tighter uppercase leading-none">What's up <span class="neon-blue">Sacha FX</span></h1>
                <nav class="flex space-x-8 mt-4">
                    <button onclick="switchTab('audit')" id="tab-audit" class="text-[10px] font-black uppercase tracking-[0.3em] active-tab pb-2 border-b-2 border-blue-500 text-blue-500">Audit</button>
                    <button onclick="switchTab('fleet')" id="tab-fleet" class="text-[10px] font-black uppercase tracking-[0.3em] text-slate-500 pb-2 hover:text-slate-300">Fleet</button>
                    <button onclick="signOut()" class="text-[10px] font-black uppercase tracking-[0.3em] text-red-500/50 hover:text-red-500 pb-2 transition">Logout</button>
                </nav>
            </div>
            <div class="glass px-8 py-3 rounded-2xl text-center border-blue-500/10 min-w-[180px]">
                <p id="clock" class="text-3xl font-mono font-black text-blue-400">00:00:00</p>
                <div class="flex items-center justify-center gap-2 mt-1">
                    <div id="sync-dot" class="w-1.5 h-1.5 rounded-full bg-emerald-500"></div>
                    <p id="sync-status-text" class="text-[9px] text-slate-500 uppercase tracking-[0.3em] font-bold">Cloud Live</p>
                </div>
            </div>
        </header>

        <div id="content-audit" class="tab-content active">
             <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="glass p-5 rounded-[2rem]">
                    <h2 class="text-[10px] font-black uppercase tracking-[0.3em] text-blue-500 mb-4 ml-2">Technicals</h2>
                    <div class="space-y-1">
                        <label class="flex items-center p-3 rounded-xl hover:bg-white/5 transition cursor-pointer"><input type="checkbox" class="trade-check" onchange="runAudit()"><span class="ml-4 text-xs text-slate-400">London Window (08:00 - 14:00)</span></label>
                        <label class="flex items-center p-3 rounded-xl hover:bg-white/5 transition cursor-pointer"><input type="checkbox" class="trade-check" onchange="runAudit()"><span class="ml-4 text-xs text-slate-400">Gold Futures Confirmation</span></label>
                        <label class="flex items-center p-3 rounded-xl hover:bg-white/5 transition cursor-pointer"><input type="checkbox" class="trade-check" onchange="runAudit()"><span class="ml-4 text-xs text-slate-400">H1 Structure Sync</span></label>
                        <label class="flex items-center p-3 rounded-xl hover:bg-white/5 transition cursor-pointer"><input type="checkbox" class="trade-check" onchange="runAudit()"><span class="ml-4 text-xs text-slate-400">OTE + M15 OB + POC</span></label>
                        <label class="flex items-center p-3 rounded-xl hover:bg-white/5 transition cursor-pointer"><input type="checkbox" class="trade-check" onchange="runAudit()"><span class="ml-4 text-xs text-slate-400">1-Tick Entry Buffer</span></label>
                    </div>
                </div>
                <div class="glass p-5 rounded-[2rem]">
                    <h2 class="text-[10px] font-black uppercase tracking-[0.3em] text-purple-500 mb-4 ml-2">Mindset</h2>
                    <div class="space-y-1">
                        <label class="flex items-center p-3 rounded-xl hover:bg-white/5 transition cursor-pointer"><input type="checkbox" class="trade-check" onchange="runAudit()"><span class="ml-4 text-xs text-slate-400">No "Ghost" Revenge (60m)</span></label>
                        <label class="flex items-center p-3 rounded-xl hover:bg-white/5 transition cursor-pointer"><input type="checkbox" class="trade-check" onchange="runAudit()"><span class="ml-4 text-xs text-slate-400">Distraction-Free</span></label>
                        <label class="flex items-center p-3 rounded-xl hover:bg-white/5 transition cursor-pointer"><input type="checkbox" class="trade-check" onchange="runAudit()"><span class="ml-4 text-xs text-slate-400">Accepted Risk Entirely</span></label>
                        <label class="flex items-center p-3 rounded-xl hover:bg-white/5 transition cursor-pointer"><input type="checkbox" class="trade-check" onchange="runAudit()"><span class="ml-4 text-xs text-slate-400">Setup Over Profit thinking</span></label>
                    </div>
                </div>
            </div>

            <div class="glass p-8 rounded-[3rem] flex flex-col md:flex-row items-center justify-between gap-6" id="verdict-container">
                <div class="text-center md:text-left"><p class="text-[9px] uppercase tracking-[0.5em] text-slate-500 font-black mb-2">Verdict</p><div id="verdict-text" class="text-3xl md:text-4xl font-black italic uppercase leading-none tracking-tighter">Standby</div></div>
                <div class="flex items-center space-x-10">
                    <div class="relative w-24 h-24 flex items-center justify-center">
                        <svg class="w-full h-full transform -rotate-90"><circle cx="50%" cy="50%" r="42%" stroke="currentColor" stroke-width="5" fill="transparent" class="text-white/5"/><circle id="progress-circle" cx="50%" cy="50%" r="42%" stroke="currentColor" stroke-width="5" fill="transparent" stroke-dasharray="264" stroke-dashoffset="264" class="transition-all duration-1000"/></svg>
                        <span id="score-percent" class="absolute text-xl font-black">0%</span>
                    </div>
                    <button onclick="logAudit()" id="log-btn" class="hidden px-8 py-3 bg-blue-600 text-white text-[10px] font-black uppercase rounded-xl shadow-lg">Log Audit</button>
                </div>
            </div>
        </div>

        <div id="content-fleet" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glass p-8 rounded-[2.5rem] space-y-6">
                    <div><h2 class="text-[10px] font-black uppercase tracking-[0.3em] text-blue-500 mb-4">Goal Target</h2><input type="number" id="target-input" onchange="cloudSave()" class="w-full rounded-2xl p-4 font-bold text-xl bg-white/5" value="500000"></div>
                    <div><h2 class="text-[10px] font-black uppercase tracking-[0.3em] text-slate-400 mb-4 italic">Deploy Unit</h2><div class="grid grid-cols-2 gap-4 mb-4"><input type="number" id="acc-size" class="rounded-xl p-3 font-bold bg-white/5" value="50000"><select id="acc-group" class="rounded-xl p-3 font-bold text-xs bg-white/5"><option value="Core">Core</option><option value="Satellite">Satellite</option></select></div><button onclick="addAccount()" class="w-full bg-blue-600 py-4 rounded-2xl font-black text-xs uppercase tracking-widest">+ Deploy Account</button></div>
                </div>
                <div class="glass p-8 rounded-[2.5rem]"><div class="flex justify-between items-end mb-4"><span id="total-val" class="text-3xl font-black tracking-tighter">$0</span><span id="target-val" class="text-xs font-mono text-slate-500">/ $500,000</span></div><div class="w-full bg-white/5 h-2 rounded-full overflow-hidden"><div id="prog-bar" class="bg-blue-600 h-full transition-all duration-1000" style="width: 0%"></div></div><div id="fleet-list" class="mt-8 space-y-3 max-h-[300px] overflow-y-auto"></div></div>
            </div>
        </div>
    </div>

    <script>
        // CONFIG
        const SUPABASE_URL = 'https://ouhdgqhhbegmnhtqcjiz.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im91aGRncWhoYmVnbW5odHFjaml6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyNjEzNzEsImV4cCI6MjA4NjgzNzM3MX0.MUoKQ9VSjeiShcgRcw_D_ZnQgm4LlNFFGSoFJ1o2A7w';
        const { createClient } = supabase;
        const _supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        let currentUser = null;
        let fleet = [], history = [], target = 500000;

        async function handleAuth(type) {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-pass').value;
            const msg = document.getElementById('auth-msg');
            msg.innerText = "Syncing with Cloud...";
            const { data, error } = type === 'login' ? await _supabase.auth.signInWithPassword({ email, password }) : await _supabase.auth.signUp({ email, password });
            if (error) msg.innerText = error.message; else checkUser();
        }

        async function checkUser() {
            const { data: { user } } = await _supabase.auth.getUser();
            if (user) {
                currentUser = user;
                document.getElementById('auth-overlay').style.display = 'none';
                document.getElementById('app-container').classList.remove('hidden');
                await cloudLoad();
            }
        }

        async function signOut() { await _supabase.auth.signOut(); location.reload(); }

        // SYNC
        async function cloudSave() {
            if (!currentUser) return;
            setSyncStatus('syncing');
            target = parseInt(document.getElementById('target-input').value) || 500000;
            const { error } = await _supabase.from('sentinel_data').upsert({ id: currentUser.id, fleet, history, target, updated_at: new Date() });
            setSyncStatus(error ? 'error' : 'live');
            refreshUI();
        }

        async function cloudLoad() {
            const { data } = await _supabase.from('sentinel_data').select('*').eq('id', currentUser.id).single();
            if (data) {
                fleet = data.fleet || []; history = data.history || []; target = data.target || 500000;
                refreshUI();
            }
        }

        function setSyncStatus(state) {
            const dot = document.getElementById('sync-dot');
            const txt = document.getElementById('sync-status-text');
            dot.className = `w-1.5 h-1.5 rounded-full ${state === 'syncing' ? 'bg-amber-500 animate-pulse' : state === 'error' ? 'bg-red-500' : 'bg-emerald-500'}`;
            if (state === 'live') txt.innerText = "Synced: " + new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        }

        // LOGGING FIX
        async function logAudit() {
            let s = 0; document.querySelectorAll('.trade-check').forEach(c => { if(c.checked) s++; });
            const entry = {
                time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}),
                date: new Date().toLocaleDateString([], {month:'short', day:'numeric'}),
                score: s, 
                verdict: document.getElementById('verdict-text').innerText
            };
            history.unshift(entry);
            if (history.length > 50) history.pop();
            
            // Push to Cloud
            await cloudSave();
            
            // Visual Reset
            resetAudit();
            refreshUI();
            toggleLog(); // Show them it was added
        }

        function refreshUI() {
            // Fleet List
            const list = document.getElementById('fleet-list'); list.innerHTML = '';
            let total = 0;
            fleet.forEach((acc, i) => {
                total += acc.size;
                list.innerHTML += `<div class="p-4 glass rounded-xl flex justify-between text-xs border border-white/5"><span>$${acc.size.toLocaleString()} • ${acc.group}</span><button onclick="remAcc(${i})" class="text-red-500/50"><i class="fas fa-trash"></i></button></div>`;
            });
            document.getElementById('total-val').innerText = `$${total.toLocaleString()}`;
            document.getElementById('target-val').innerText = `/ $${target.toLocaleString()}`;
            document.getElementById('prog-bar').style.width = (total/target*100)+'%';
            document.getElementById('target-input').value = target;

            // Floating History List
            const hList = document.getElementById('audit-history-list');
            hList.innerHTML = '';
            history.forEach(h => {
                const color = h.verdict.includes('Execute') ? 'text-emerald-500' : 'text-amber-500';
                hList.innerHTML += `<div class="p-4 bg-white/[0.03] rounded-2xl border border-white/5"><div class="text-[10px] font-black uppercase tracking-widest ${color}">${h.verdict}</div><div class="text-[8px] text-slate-500 mt-2 font-bold uppercase">${h.date} • ${h.time} • Score: ${h.score}/9</div></div>`;
            });
        }

        function runAudit() {
            let s = 0; document.querySelectorAll('.trade-check').forEach(c => { if(c.checked) s++; });
            const p = s / 9;
            document.getElementById('progress-circle').style.strokeDashoffset = 264 * (1 - p);
            document.getElementById('score-percent').innerText = Math.round(p*100)+'%';
            const cont = document.getElementById('verdict-container');
            const txt = document.getElementById('verdict-text');
            cont.classList.remove('verdict-denied', 'verdict-caution', 'verdict-elite');
            document.getElementById('log-btn').classList.toggle('hidden', s < 8);
            if(s === 9) { txt.innerText = "Sacha, Execute"; cont.classList.add('verdict-elite'); progressCircle.style.color = "#00ff88"; }
            else if(s >= 8) { txt.innerText = "Caution: Satellite"; cont.classList.add('verdict-caution'); progressCircle.style.color = "#ffcc00"; }
            else { txt.innerText = "System Locked"; cont.classList.add('verdict-denied'); progressCircle.style.color = "#ff4d4d"; }
        }

        function resetAudit() { document.querySelectorAll('.trade-check').forEach(c => c.checked = false); runAudit(); }
        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(b => {
                b.className = "text-[10px] font-black uppercase tracking-[0.3em] text-slate-500 pb-2 transition-all";
            });
            document.getElementById('content-'+t).classList.add('active');
            const btn = document.getElementById('tab-'+t);
            btn.className = "text-[10px] font-black uppercase tracking-[0.3em] active-tab pb-2 text-blue-500 border-b-2 border-blue-500";
        }
        function toggleLog() { document.getElementById('side-log').classList.toggle('open'); }
        function addAccount() { fleet.push({ id: Date.now(), size: parseInt(document.getElementById('acc-size').value), group: document.getElementById('acc-group').value }); cloudSave(); }
        function remAcc(i) { fleet.splice(i, 1); cloudSave(); }
        function clearLogs() { if(confirm("Clear history?")) { history = []; cloudSave(); } }

        checkUser();
        setInterval(() => {
            const now = new Date(); const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            document.getElementById('clock').innerText = new Date(utc + 3600000).toTimeString().split(' ')[0];
        }, 1000);
    </script>
</body>
</html>